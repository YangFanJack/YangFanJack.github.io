<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>SSM框架-Spring - Jack&#39;s Blog Site</title><meta name="Description" content="This is my cool site"><meta property="og:title" content="SSM框架-Spring" />
<meta property="og:description" content="Spring简介 Spring前身：EJB框架 Spring优点 方便解耦，简化开发：IOC容器使对象的依赖关系由Spring控制，编程者更专注于" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-20T22:40:22+00:00" />
<meta property="article:modified_time" content="2021-01-20T22:40:22+00:00" /><meta property="og:site_name" content="My cool site" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSM框架-Spring"/>
<meta name="twitter:description" content="Spring简介 Spring前身：EJB框架 Spring优点 方便解耦，简化开发：IOC容器使对象的依赖关系由Spring控制，编程者更专注于"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" /><link rel="prev" href="http://yangfanjack.top/posts/%E7%B2%BE%E7%AE%80%E7%89%88js-jquery/" /><link rel="next" href="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-springmvc/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "SSM框架-Spring",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/yangfanjack.top\/posts\/ssm%E6%A1%86%E6%9E%B6-spring\/"
        },"genre": "posts","keywords": "后端, JavaWeb, Spring","wordcount":  8476 ,
        "url": "http:\/\/yangfanjack.top\/posts\/ssm%E6%A1%86%E6%9E%B6-spring\/","datePublished": "2021-01-20T22:40:22+00:00","dateModified": "2021-01-20T22:40:22+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Jack Yang"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Jack&#39;s Blog Site">My cool site</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Jack&#39;s Blog Site">My cool site</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">SSM框架-Spring</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Jack Yang</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>学习笔记</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-01-20">2021-01-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;8476 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;17 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#spring简介">Spring简介</a>
      <ul>
        <li><a href="#spring优点">Spring优点</a></li>
        <li><a href="#spring程序大致步骤">Spring程序大致步骤</a></li>
      </ul>
    </li>
    <li><a href="#spring核心配置文件">Spring核心配置文件</a>
      <ul>
        <li><a href="#bean标签">bean标签</a></li>
        <li><a href="#依赖注入">依赖注入</a></li>
        <li><a href="#sprng配置文件拆解合并">Sprng配置文件拆解合并</a></li>
      </ul>
    </li>
    <li><a href="#spring相关api">Spring相关API</a>
      <ul>
        <li><a href="#applicationcontext继承体系">ApplicationContext继承体系</a></li>
        <li><a href="#getbean方法">getBean方法</a></li>
      </ul>
    </li>
    <li><a href="#spring配置数据源连接池">Spring配置数据源（连接池）</a></li>
    <li><a href="#spring注解开发">Spring注解开发</a>
      <ul>
        <li><a href="#原始注解">原始注解</a></li>
        <li><a href="#新注解">新注解</a></li>
      </ul>
    </li>
    <li><a href="#spring整合junit">Spring整合Junit</a></li>
    <li><a href="#aop">AOP</a>
      <ul>
        <li><a href="#什么是aop">什么是AOP？</a></li>
        <li><a href="#aop底层原理动态代理">AOP底层原理：动态代理</a></li>
        <li><a href="#aop相关概念">AOP相关概念：</a></li>
        <li><a href="#aop开发需要明确的事项">AOP开发需要明确的事项</a></li>
        <li><a href="#xml-配置-aop-详解">XML 配置 AOP 详解</a></li>
        <li><a href="#注解配置-aop-详解">注解配置 AOP 详解</a></li>
      </ul>
    </li>
    <li><a href="#spring-jdbctemplate">Spring JDBCTemplate</a></li>
    <li><a href="#spring事务">Spring事务</a>
      <ul>
        <li><a href="#编程式事务控制">编程式事务控制</a></li>
        <li><a href="#基于xml的声明式事务控制">基于XML的声明式事务控制</a></li>
        <li><a href="#基于注解的声明式事务控制">基于注解的声明式事务控制</a></li>
      </ul>
    </li>
    <li><a href="#spring集成web环境">Spring集成web环境</a>
      <ul>
        <li><a href="#applicationcontext应用上下文获取方式">ApplicationContext应用上下文获取方式</a></li>
        <li><a href="#spring提供获取应用上下文的工具">Spring提供获取应用上下文的工具</a></li>
        <li><a href="#导入spring集成web的坐标">导入Spring集成web的坐标</a></li>
        <li><a href="#配置contextloaderlistener监听器">配置ContextLoaderListener监听器</a></li>
        <li><a href="#通过工具获得应用上下文对象">通过工具获得应用上下文对象</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="spring简介">Spring简介</h2>
<ul>
<li>Spring前身：EJB框架</li>
</ul>
<h3 id="spring优点">Spring优点</h3>
<ol>
<li>方便解耦，简化开发：IOC容器使对象的依赖关系由Spring控制，编程者更专注于上层的应用</li>
<li>AOP编程的支持：方便面向切面编程</li>
<li>声明式事务的控制：配置的方式简化开发</li>
<li>Junit：方便程序测试</li>
<li>方便集成各种优秀的框架：Mybatis等</li>
<li>降低JavaEE API的使用难度：提供了一些工具的封装类</li>
<li>开源：方便学习</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230249.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230249.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230249.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230249.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230249.png"
        title="img" /></p>
<h3 id="spring程序大致步骤">Spring程序大致步骤</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230259.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230259.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230259.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230259.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230259.png"
        title="image-20210312105112356" /></p>
<ol>
<li>导入Spring开发的maven依赖</li>
<li>编写Dao接口和实现类</li>
<li>创建Spring核心配置文件applicationContext.xml</li>
<li>在Spring配置文件中配置实现类</li>
<li>使用Spring的API获得Bean实例</li>
</ol>
<h2 id="spring核心配置文件">Spring核心配置文件</h2>
<h3 id="bean标签">bean标签</h3>
<ol>
<li>**id：**唯一性标识，通过其获得对象</li>
<li>**class：**bean的全限定名称</li>
<li>**scope：**singleton(默认)，prototype等5个
<ul>
<li>scope：bean对象在核心配置文件加载时就创建，只有一个，spring容器销毁时才会销毁bean</li>
<li>prototype：bean对象在每次getBean时创建一个，对象长时间不用会被GC垃圾回收机制回收</li>
</ul>
</li>
<li>**init-method：**指定类中初始化方法名称，对象创建后执行</li>
<li>**destory-method：**指定类中销毁方法名称，对象销毁前执行</li>
<li><strong>bean实例化的三种方式：</strong>
<ol>
<li>无参构造实例化：默认</li>
<li>工厂静态方法实例化：factory-method=“工厂方法”，class中写工厂类</li>
<li>工厂实例方法实例化：需要先bean一个工厂对象，然后factory-bean=“工厂实例”，factory-method=“工厂方法”</li>
</ol>
</li>
</ol>
<h3 id="依赖注入">依赖注入</h3>
<ul>
<li>依赖注入是Spring框架核心IOC的具体体现</li>
<li>通过控制反转，把对象的控制权交给Spring容器。IOC解耦可以降低Service业务层和Dao持久层之间的关系，此时依赖关系就由Spring来维护了，Spring容器会自己把持久层对象传入业务层。</li>
<li>如何把UserDao依赖注入到UserService中？</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">构造方法
</span></span></span><span class="line"><span class="cl"><span class="cm">**/</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserDao</span> <span class="n">userDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">UserServiceImpl</span><span class="o">(</span><span class="n">UserDao</span> <span class="n">userDao</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">userDao</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">userServiceImpl</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">usreDao</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//name指的构造函数的参数名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.dao.impl.UserDaoImpl&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;userService&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.service.impl.UserServiceImpl&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">constructor</span><span class="o">-</span><span class="n">arg</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span> <span class="n">ref</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span><span class="o">&gt;&lt;/</span><span class="n">constructor</span><span class="o">-</span><span class="n">arg</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">set方法
</span></span></span><span class="line"><span class="cl"><span class="cm">**/</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserDao</span> <span class="n">userDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUserDao</span><span class="o">(</span><span class="n">UserDao</span> <span class="n">userDao</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">userDao</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">usreDao</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//name指的set的方法除去set后首字母小写后的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.dao.impl.UserDaoImpl&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;userService&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.service.impl.UserServiceImpl&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span> <span class="n">ref</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//也可以使用p命名空间注入: xmlns=&#34;http://www.springframework.org/schema/p&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;userService&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.service.impl.UserServiceImpl&#34;</span> <span class="n">p</span><span class="o">:</span><span class="n">userDao</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span></code></pre></div><ul>
<li>依赖注入的数据类型：
<ol>
<li>普通数据类型</li>
<li>集合数据类型</li>
<li>引用数据类型</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Getter &amp; Setter 省略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">userMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Setter 省略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.dao.impl.UserDaoImpl&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;Sam Smith&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;age&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;26&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;list&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    	<span class="o">&lt;</span><span class="n">list</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        	<span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">aaa</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">bbb</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="n">ccc</span><span class="o">&lt;/</span><span class="n">value</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">list</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">property</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;userMap&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    	<span class="o">&lt;</span><span class="n">map</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        	<span class="o">&lt;</span><span class="n">entry</span> <span class="n">key</span><span class="o">=</span><span class="s">&#34;firstUser&#34;</span> <span class="n">value</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="s">&#34;user1&#34;</span><span class="o">&gt;&lt;/</span><span class="n">entry</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="n">entry</span> <span class="n">key</span><span class="o">=</span><span class="s">&#34;secondUser&#34;</span> <span class="n">value</span><span class="o">-</span><span class="n">ref</span><span class="o">=</span><span class="s">&#34;user2&#34;</span><span class="o">&gt;&lt;/</span><span class="n">entry</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;/</span><span class="n">map</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">property</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;user1&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.domain.User&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;Jobs&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;email&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;112233@qq.com&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;user2&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;link.jack1024.domain.User&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;Marks&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;email&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;445566@qq.com&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span></code></pre></div><h3 id="sprng配置文件拆解合并">Sprng配置文件拆解合并</h3>
<ul>
<li>如果所有Spring容器的配置文件都放在applicationContext.xml核心配置文件中，那将会十分庞大，所以可以按照程序分层Controller，Service，Dao将配置文件也拆分为几个xml文件，最后在applicationContext.xml核心配置文件中import即可</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&#34;spring-mvc.xml&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&#34;spring-sevice.xml&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">&#34;spring-dao.xml&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></div><h2 id="spring相关api">Spring相关API</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">UserDao</span> <span class="n">userDao1</span> <span class="o">=</span> <span class="o">(</span><span class="n">UserDao</span><span class="o">)</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;userDao&#34;</span><span class="o">);</span>
</span></span></code></pre></div><h3 id="applicationcontext继承体系">ApplicationContext继承体系</h3>
<ul>
<li>ApplicationContext的3个常用实现类
<ol>
<li>ClassPathXmlApplicationContext：从类的根路径下加载配置文件</li>
<li>FileSystemXmlApplicationContext：从磁盘路径下加载配置文件</li>
<li>AnnotationConfigApplicationContext：当使用你注解配置容器对象时，需要使用此类创建spring容器。它用来读取注解</li>
</ol>
</li>
</ul>
<h3 id="getbean方法">getBean方法</h3>
<ol>
<li>getBean(bean的id)：配置文件中可以有多个同类型的bean</li>
<li>getBean(bean对应类.class)：配置文件中一个类型只能有一个bean，否则无法识别</li>
</ol>
<h2 id="spring配置数据源连接池">Spring配置数据源（连接池）</h2>
<p>**常见数据源：**DBCP，C3P0，BnoeCP，Druid</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.1.32<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- https://mvnrepository.com/artifact/com.mchange/c3p0 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.mchange<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>c3p0<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.9.1.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.1.10<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-web --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.2.12.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><strong>之前创建数据库连接池都是通过代码手动创建的，通过Spring完全可以将数据库连接池的控制反转给Spring容器，将数据库信息注入给数据库连接池对象。</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--applicationContext.xml--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="o">(</span><span class="n">DataSource</span><span class="o">)</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;dataSource&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">connection</span><span class="o">);</span>
</span></span></code></pre></div><p>继续解耦，把数据库信息解到properties文件中</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">applicationContext.xml加载jdbc.properties配置文件获得连接信息。
</span></span></span><span class="line"><span class="cl"><span class="c">
</span></span></span><span class="line"><span class="cl"><span class="c">首先，需要引入context命名空间和约束路径：
</span></span></span><span class="line"><span class="cl"><span class="c">命名空间：xmlns:context=&#34;http://www.springframework.org/schema/context&#34;
</span></span></span><span class="line"><span class="cl"><span class="c">约束路径：
</span></span></span><span class="line"><span class="cl"><span class="c">http://www.springframework.org/schema/context
</span></span></span><span class="line"><span class="cl"><span class="c">http://www.springframework.org/schema/context/spring-context.xsd
</span></span></span><span class="line"><span class="cl"><span class="c">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath:c3p0.properties&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span></code></pre></div><h2 id="spring注解开发">Spring注解开发</h2>
<ul>
<li>Spring是轻代码而重配置的框架，配置比较繁重，影响开发效率，所以<strong>注解开发是一种趋势</strong>，注解代替xml配置文件可以简化配置，提高开发效率。</li>
</ul>
<h3 id="原始注解">原始注解</h3>
<ul>
<li>Spring原始注解主要是替代<code>&lt;Bean&gt;</code>的配置</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230317.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230317.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230317.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230317.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230317.png"
        title="image-20210319092521680" /></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">使用注解进行开发时，需要在applicationContext.xml中配置组件扫描，作用是指定哪个包及其子包下的Bean需要进行扫描以便识别使用注解配置的类、字段和方法。
</span></span></span><span class="line"><span class="cl"><span class="c">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--注解的组件扫描--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.jack1024&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//@Component(&#34;userDao&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Repository</span><span class="o">(</span><span class="s">&#34;userDao&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;save running... ...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//@Component(&#34;userService&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Service</span><span class="o">(</span><span class="s">&#34;userService&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceImpl</span> <span class="kd">implements</span> <span class="n">UserService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/*@Autowired
</span></span></span><span class="line"><span class="cl"><span class="cm">    @Qualifier(&#34;userDao&#34;)*/</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;userDao&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserDao</span> <span class="n">userDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">userDao</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><strong>注意：</strong></p>
<ol>
<li>@Autowired默认按照数据类型匹配注入</li>
<li>@Autowired结合@Qualifier会按照id匹配注入</li>
<li>@Resource相当于@Autowired+@resource</li>
<li>注解方式@Autowired、@Qualifier，@resource来依赖注入，不需要写set方法了</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//@Value注入普通数据类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Repository</span><span class="o">(</span><span class="s">&#34;userDao&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;注入普通数据&#34;</span><span class="o">)</span><span class="c1">//没多大意义
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">str</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="o">)</span><span class="c1">//很有意义：Spring配置类中会用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">String</span> <span class="n">driver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">driver</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;save running... ...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Bean的创建形式
</span></span></span><span class="line"><span class="cl"><span class="c1">//@Scope(&#34;prototype&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Scope</span><span class="o">(</span><span class="s">&#34;singleton&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//此处省略代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//使用@PostConstruct标注初始化方法，使用@PreDestroy标注销毁方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@PostConstruct</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;初始化方法....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nd">@PreDestroy</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;销毁方法.....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="新注解">新注解</h3>
<ul>
<li>使用原始注解还不能全部替代xml配置文件，还需要使用注解替代的配置如下
<ol>
<li>非自定义的Bean的配置：<code>&lt;bean&gt;</code>（例如Datasource）</li>
<li>加载properties文件的配置：<code>&lt;context:property-placeholder&gt;</code></li>
<li>组件扫描的配置：<code>&lt;context:component-scan&gt;</code></li>
<li>引入其他文件：<code>&lt;import&gt;</code></li>
</ol>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230327.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230327.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230327.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230327.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230327.png"
        title="image-20210319101631835" /></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//Spring的配置类，使用class电梯xml，使用注解代替标签
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">&#34;com.jack1024&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Import</span><span class="o">({</span><span class="n">DataSourceConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfiguration</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@PropertySource</span><span class="o">(</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataSourceConfiguration</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">driver</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">url</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Spring将当前方法的返回值以指定名称存在Spring容器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;dataSource&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">getDataSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">driver</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//测试加载核心配置类创建Spring容器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAnnoConfiguration</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//加载核心配置类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">SpringConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="o">(</span><span class="n">UserService</span><span class="o">)</span><span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;userService&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">userService</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="o">(</span><span class="n">DataSource</span><span class="o">)</span><span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;dataSource&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">connection</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>**注意：**这种全注解配置的方法在SSM不强制使用，但是在SpringBoot中很常用</p>
<h2 id="spring整合junit">Spring整合Junit</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//测试类中很繁琐
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;bean.xml&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">IAccountService</span> <span class="n">as</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;accountService&#34;</span><span class="o">,</span><span class="n">IAccountService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span></code></pre></div><p><strong>改进：</strong></p>
<ol>
<li>让SpringJunit负责创建Spring容器，但是需要将配置文件的名称告诉它</li>
<li>将需要进行测试Bean直接在测试类中进行注入</li>
</ol>
<p><strong>Spring继承Junit步骤：</strong></p>
<ol>
<li>导入spring集成Junit的maven依赖</li>
<li>使用@Runwith注解替换原来的运行期</li>
<li>使用@ContextConfiguration指定配置文件或配置类</li>
<li>使用@Autowired注入需要测试的对象</li>
<li>创建测试方法进行测试</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-test<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.0.2.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>4.12<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">//加载spring核心配置文件
</span></span></span><span class="line"><span class="cl"><span class="c1">//@ContextConfiguration(value = {&#34;classpath:applicationContext.xml&#34;})
</span></span></span><span class="line"><span class="cl"><span class="c1">//加载spring核心配置类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="o">{</span><span class="n">SpringConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringJunitTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUserService</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">userService</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="aop">AOP</h2>
<h3 id="什么是aop">什么是AOP？</h3>
<p>AOP 为 Aspect Oriented Programming 的缩写，意思为面向切面编程，是通过预编译方式和运行期<strong>动态代理</strong>实现程序功能的统一维护的一种技术。</p>
<p>AOP 是 OOP 的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。（举个栗子：A和B需要结合，但是是通过程序运行时的动态结合，可以很好地解耦）</p>
<p>**AOP作用一句话总结：**程序运行时在不修改源码情况下动态对代码增强功能</p>
<p>**AOP优势：**减少重复代码，提高开发效率，便于维护</p>
<h3 id="aop底层原理动态代理">AOP底层原理：动态代理</h3>
<ul>
<li>实际上，AOP 的底层是通过 Spring 提供的的<strong>动态代理</strong>技术实现的。在运行期间，Spring通过动态代理技术动态的生成代理对象，代理对象方法执行时进行增强功能的介入，再去调用目标对象的方法，从而完成功能的增强。</li>
</ul>
<p>JDK代理：基于接口的动态代理</p>
<p>cglib代理：基于父类的动态代理</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230334.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230334.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230334.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230334.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230334.png"
        title="image-20210319145522857" /></p>
<h4 id="基于jdk的动态代理">基于JDK的动态代理</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Target</span> <span class="kd">implements</span> <span class="n">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Target running....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Target</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Target</span><span class="o">();</span> <span class="c1">//创建目标对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//创建代理对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TargetInterface</span> <span class="n">proxy</span> <span class="o">=</span> <span class="o">(</span><span class="n">TargetInterface</span><span class="o">)</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span><span class="c1">//目标对象的类加载器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span><span class="c1">//目标对象相同的接口字节码对象数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">new</span> <span class="n">InvocationHandler</span><span class="o">()</span> <span class="o">{</span><span class="c1">//调用代理对象任何方法，实质都是执行invoke方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">Method</span> <span class="n">method</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> 
</span></span><span class="line"><span class="cl">            <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置增强代码...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;后置增强代码...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 测试,当调用接口的任何方法时，代理对象的代码都无需修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">proxy</span><span class="o">.</span><span class="na">method</span><span class="o">();</span>
</span></span></code></pre></div><h4 id="基于cglib的动态代理">基于cglib的动态代理</h4>
<ul>
<li>虽然是第三方的实现，但是现在spring-core包已经将cglib拿进来了，无需手动导入</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Target</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Target running....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Target</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Target</span><span class="o">();</span> <span class="c1">//创建目标对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Enhancer</span> <span class="n">enhancer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Enhancer</span><span class="o">();</span>   <span class="c1">//创建增强器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">enhancer</span><span class="o">.</span><span class="na">setSuperclass</span><span class="o">(</span><span class="n">Target</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">//设置父类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">enhancer</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">MethodInterceptor</span><span class="o">()</span> <span class="o">{</span> <span class="c1">//设置回调
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">intercept</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">o</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">MethodProxy</span> <span class="n">methodProxy</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置代码增强....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;后置代码增强....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">});</span>
</span></span><span class="line"><span class="cl"><span class="n">Target</span> <span class="n">proxy</span> <span class="o">=</span> <span class="o">(</span><span class="n">Target</span><span class="o">)</span> <span class="n">enhancer</span><span class="o">.</span><span class="na">create</span><span class="o">();</span> <span class="c1">//创建代理对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//测试,当调用接口的任何方法时，代理对象的代码都无需修改
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">proxy</span><span class="o">.</span><span class="na">method</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="aop相关概念">AOP相关概念：</h3>
<ul>
<li><strong>Target（目标对象）</strong>：代理的目标对象</li>
<li><strong>Proxy （代理）</strong>：一个类被 AOP 织入增强后，就产生一个结果代理类</li>
<li><strong>Joinpoint（连接点）</strong>：所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法，因为spring只支持方法类型的连接点</li>
<li><strong>Pointcut（切入点）</strong>：所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义</li>
</ul>
<p>**注意：**连接点是可以被增强的方法，切入点是真正被增强的方法。切入点是连接点的一部分。</p>
<ul>
<li><strong>Advice（通知/ 增强）</strong>：所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知</li>
<li><strong>Aspect（切面）</strong>：是切入点和通知（引介）的结合</li>
<li><strong>Weaving（织入）</strong>：是指把增强应用到目标对象来创建新的代理对象的过程。spring<strong>采用动态代理织入</strong>，而AspectJ采用编译期织入和类装载期织入</li>
</ul>
<h3 id="aop开发需要明确的事项">AOP开发需要明确的事项</h3>
<ol>
<li>
<p><strong>需要编写的内容</strong></p>
<ol>
<li>编写核心业务代码（目标类的目标方法）</li>
<li>编写切面类，切面类中有通知(增强功能方法)</li>
<li>在配置文件中，配置织入关系，即将哪些Advice与哪些Pointcut进行结合</li>
</ol>
</li>
<li>
<p><strong>AOP 技术实现的内容</strong></p>
<p>Spring 框架监控切入点方法的执行。一旦监控到切入点方法被运行，使用代理机制，动态创建目标对象的代理对象，根据通知类别，在代理对象的对应位置，将通知对应的功能织入，完成完整的代码逻辑运行。</p>
</li>
<li>
<p><strong>AOP 底层使用哪种代理方式</strong></p>
<p>在 spring 中，框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式。</p>
</li>
</ol>
<h3 id="xml-配置-aop-详解">XML 配置 AOP 详解</h3>
<ol>
<li>导入 AOP 相关坐标</li>
<li>创建目标接口和目标类（内部有切点）</li>
<li>创建切面类（内部有增强方法）</li>
<li>将目标类和切面类的对象创建权交给 spring</li>
<li>在 applicationContext.xml 中配置织入关系</li>
<li>测试代码</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--导入spring的context坐标，context依赖aop--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>5.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!-- aspectj的织入 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.aspectj<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>aspectjweaver<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>1.8.13<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//目标接口和目标类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Target</span> <span class="kd">implements</span> <span class="n">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Target running....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//创建切面类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAspect</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//前置增强方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置代码增强.....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--在 applicationContext.xml 中配置织入关系--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/context
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/context/spring-context.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/aop
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/aop/spring-aop.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/beans
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--将目标类和切面类的对象创建权交给 spring--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--配置目标类--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;target&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itheima.aop.Target&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--配置切面类--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;myAspect&#34;</span> <span class="na">class=</span><span class="s">&#34;com.itheima.aop.MyAspect&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;aop:config&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--声明myAspect的Bean为切面对象--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;aop:aspect</span> <span class="na">ref=</span><span class="s">&#34;myAspect&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--配置Target的method方法执行时要进行myAspect的before方法前置增强--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">&#34;before&#34;</span> <span class="na">pointcut=</span><span class="s">&#34;execution(public void com.itheima.aop.Target.method())&#34;</span><span class="nt">&gt;&lt;/aop:before&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/aop:aspect&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/aop:config&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//测试代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="s">&#34;classpath:applicationContext.xml&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AopTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">TargetInterface</span> <span class="n">target</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="na">method</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="切点表达式的写法">切点表达式的写法</h4>
<p>表达式语法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="o">([</span><span class="err">修饰符</span><span class="o">]</span> <span class="err">返回值类型</span> <span class="err">包名</span><span class="o">.</span><span class="err">类名</span><span class="o">.</span><span class="err">方法名</span><span class="o">(</span><span class="err">参数</span><span class="o">))</span>
</span></span></code></pre></div><ul>
<li>
<p>访问修饰符可以省略</p>
</li>
<li>
<p>返回值类型、包名、类名、方法名可以使用星号*  代表任意</p>
</li>
<li>
<p>包名与类名之间一个点 . 代表当前包下的类，两个点 .. 表示当前包及其子包下的类</p>
</li>
<li>
<p>参数列表可以使用两个点 .. 表示任意个数，任意类型的参数列表</p>
</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">execution(public void com.itheima.aop.Target.method())	
</span></span><span class="line"><span class="cl">execution(void com.itheima.aop.Target.*(..))
</span></span><span class="line"><span class="cl">execution(* com.itheima.aop.*.*(..))
</span></span><span class="line"><span class="cl">execution(* com.itheima.aop..*.*(..))
</span></span><span class="line"><span class="cl">execution(* *..*.*(..))
</span></span></code></pre></div><h4 id="通知的类型">通知的类型</h4>
<p>通知的配置语法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;aop:</span><span class="err">通知类型</span> <span class="na">method=</span><span class="s">“切面类中方法名”</span> <span class="na">pointcut=</span><span class="s">“切点表达式&#34;</span><span class="nt">&gt;</span><span class="err">&lt;</span>/aop:通知类型&gt;
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230344.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230344.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230344.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230344.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230344.png"
        title="image-20210319185243993" /></p>
<h4 id="切点表达式的抽取">切点表达式的抽取</h4>
<p>当多个增强的切点表达式相同时，可以将切点表达式进行抽取，在增强中使用 pointcut-ref 属性代替 pointcut 属性来引用抽取后的切点表达式。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;aop:config&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--引用myAspect的Bean为切面对象--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;aop:aspect</span> <span class="na">ref=</span><span class="s">&#34;myAspect&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;myPointcut&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* com.itheima.aop.*.*(..))&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;aop:before</span> <span class="na">method=</span><span class="s">&#34;before&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;myPointcut&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/aop:aspect&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/aop:config&gt;</span>
</span></span></code></pre></div><h3 id="注解配置-aop-详解">注解配置 AOP 详解</h3>
<ol>
<li>创建目标接口和目标类（内部有切点）</li>
<li>创建切面类（内部有增强方法）</li>
<li>将目标类和切面类的对象创建权交给 spring</li>
<li>在切面类中使用注解配置织入关系</li>
<li>在配置文件中开启组件扫描和 AOP 的自动代理</li>
<li>测试</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Target</span> <span class="kd">implements</span> <span class="n">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Target running....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAspect</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//前置增强方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置代码增强.....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Component</span><span class="o">(</span><span class="s">&#34;target&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Target</span> <span class="kd">implements</span> <span class="n">TargetInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Target running....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Component</span><span class="o">(</span><span class="s">&#34;myAspect&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAspect</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置代码增强.....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Component</span><span class="o">(</span><span class="s">&#34;myAspect&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Aspect</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAspect</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Before</span><span class="o">(</span><span class="s">&#34;execution(* com.itheima.aop.*.*(..))&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置代码增强.....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--组件扫描--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.itheima.aop&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--aop的自动代理，用于识别aop专属注解--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//测试代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="s">&#34;classpath:applicationContext.xml&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AopTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">TargetInterface</span> <span class="n">target</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">target</span><span class="o">.</span><span class="na">method</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="切点表达式的抽取-1">切点表达式的抽取</h4>
<h4 id="注解通知的类型">注解通知的类型</h4>
<p>通知的配置语法：@通知注解(“切点表达式&quot;)</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230353.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230353.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230353.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230353.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230353.png"
        title="image-20210319193734452" /></p>
<h4 id="切点表达式的抽取-2">切点表达式的抽取</h4>
<p>同 xml配置
aop 一样，我们可以将切点表达式抽取。抽取方式是在切面内定义方法，在该方法上使用@Pointcut注解定义切点表达式，然后在在增强注解中进行引用。具体如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="err">@</span><span class="nd">@Component</span><span class="o">(</span><span class="s">&#34;myAspect&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Aspect</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAspect</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Before</span><span class="o">(</span><span class="s">&#34;MyAspect.myPoint()&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;前置代码增强.....&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Pointcut</span><span class="o">(</span><span class="s">&#34;execution(* com.itheima.aop.*.*(..))&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">myPoint</span><span class="o">(){}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="spring-jdbctemplate">Spring JDBCTemplate</h2>
<ol>
<li>导入spring-jdbc和spring-tx坐标</li>
<li>创建数据库表和实体</li>
<li>创建JdbcTemplate对象</li>
<li>执行数据库操作</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-tx<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><strong>JDBCTemplate的基本使用参考博客《JDBC》</strong></p>
<p><strong>我们可以将JdbcTemplate的创建权交给Spring，将数据源DataSource的创建权也交给Spring，在Spring容器内部将数据源DataSource注入到JdbcTemplate模版对象中,然后通过Spring容器获得JdbcTemplate对象来执行操作。</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--jdbc.properties--&gt;</span>
</span></span><span class="line"><span class="cl">jdbc.driver=com.mysql.jdbc.Driver
</span></span><span class="line"><span class="cl">jdbc.url=jdbc:mysql://localhost:3306/test
</span></span><span class="line"><span class="cl">jdbc.username=root
</span></span><span class="line"><span class="cl">jdbc.password=root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--applicationContext.xml--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--加载jdbc.properties--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">&#34;classpath:jdbc.properties&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--数据源对象--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.driver}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.url}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.username}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;${jdbc.password}&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--jdbc模板对象--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;jdbcTemplate&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.core.JdbcTemplate&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="c1">//测试Spring产生jdbcTemplate对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ApplicationContext</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">JdbcTemplate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">row</span> <span class="o">=</span> <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&#34;insert into account values(?,?)&#34;</span><span class="o">,</span> <span class="s">&#34;lisi&#34;</span><span class="o">,</span> <span class="mi">5000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">row</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="spring事务">Spring事务</h2>
<h3 id="编程式事务控制">编程式事务控制</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230403.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230403.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230403.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230403.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230403.png"
        title="image-20210319210646503" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230428.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230428.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230428.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230428.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230428.png"
        title="image-20210319211610424" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230433.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230433.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230433.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230433.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230433.png"
        title="image-20210319220103243" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230449.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230449.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230449.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230449.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230449.png"
        title="image-20210319220336119" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230456.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230456.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230456.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230456.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230456.png"
        title="image-20210319220351682" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230503.png"
        data-srcset="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230503.png, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230503.png 1.5x, https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230503.png 2x"
        data-sizes="auto"
        alt="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20220521230503.png"
        title="image-20210319220537567" /></p>
<h3 id="基于xml的声明式事务控制">基于XML的声明式事务控制</h3>
<p>Spring 的声明式事务顾名思义就是采用声明的方式来处理事务。这里所说的声明，就是指在配置文件中声明，用在 Spring 配置文件中声明式的处理事务来代替代码式的处理事务。</p>
<p><strong>声明式事务处理的作用</strong></p>
<ul>
<li>
<p>事务管理不侵入开发的组件。具体来说，业务逻辑对象就不会意识到正在事务管理之中，事实上也应该如此，因为事务管理是属于系统层面的服务，而不是业务逻辑的一部分，如果想要改变事务管理策划的话，也只需要在定义文件中重新配置即可</p>
</li>
<li>
<p>在不需要事务管理的时候，只要在设定文件上修改一下，即可移去事务管理服务，无需改变代码重新编译，这样维护起来极其方便</p>
</li>
</ul>
<p><strong>注意：Spring 声明式事务控制底层就是AOP。</strong></p>
<h4 id="代码">代码</h4>
<ol>
<li><strong>引入tx命名空间</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xmlns:tx=</span><span class="s">&#34;http://www.springframework.org/schema/tx&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/context
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/context/spring-context.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/aop
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/aop/spring-aop.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/tx 
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/tx/spring-tx.xsd
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/beans
</span></span></span><span class="line"><span class="cl"><span class="s">        http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span class="nt">&gt;</span>
</span></span></code></pre></div><ol start="2">
<li><strong>配置事务增强</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--平台事务管理器--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;transactionManager&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--事务增强配置--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;tx:attributes&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;*&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/tx:attributes&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/tx:advice&gt;</span>
</span></span></code></pre></div><ol start="3">
<li><strong>配置事务 AOP 织入</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--事务的aop增强--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;aop:config&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;myPointcut&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution(* com.itheima.service.impl.*.*(..))&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">pointcut-ref=</span><span class="s">&#34;myPointcut&#34;</span><span class="nt">&gt;&lt;/aop:advisor&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/aop:config&gt;</span>
</span></span></code></pre></div><ol start="4">
<li><strong>测试事务控制转账业务代码</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="n">String</span> <span class="n">outMan</span><span class="o">,</span> <span class="n">String</span> <span class="n">inMan</span><span class="o">,</span> <span class="kt">double</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">accountDao</span><span class="o">.</span><span class="na">out</span><span class="o">(</span><span class="n">outMan</span><span class="o">,</span><span class="n">money</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">accountDao</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">inMan</span><span class="o">,</span><span class="n">money</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="切点方法的事务参数的配置">切点方法的事务参数的配置</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--事务增强配置--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--设置事务的属性信息--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;tx:attributes&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;*&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/tx:attributes&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/tx:advice&gt;</span>
</span></span></code></pre></div><p>其中，<a href="tx:method" rel="">tx:method</a> 代表切点方法的事务参数的配置，例如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;transfer&#34;</span> <span class="na">isolation=</span><span class="s">&#34;REPEATABLE_READ&#34;</span> <span class="na">propagation=</span><span class="s">&#34;REQUIRED&#34;</span> <span class="na">timeout=</span><span class="s">&#34;-1&#34;</span> <span class="na">read-only=</span><span class="s">&#34;false&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></div><ul>
<li>
<p>name：切点方法名称</p>
</li>
<li>
<p>isolation:事务的隔离级别</p>
</li>
<li>
<p>propogation：事务的传播行为</p>
</li>
<li>
<p>timeout：超时时间</p>
</li>
<li>
<p>read-only：是否只读</p>
</li>
</ul>
<h3 id="基于注解的声明式事务控制">基于注解的声明式事务控制</h3>
<ol>
<li>编写 AccoutDao</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Repository</span><span class="o">(</span><span class="s">&#34;accountDao&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountDaoImpl</span> <span class="kd">implements</span> <span class="n">AccountDao</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">out</span><span class="o">(</span><span class="n">String</span> <span class="n">outMan</span><span class="o">,</span> <span class="kt">double</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&#34;update account set money=money-? where name=?&#34;</span><span class="o">,</span><span class="n">money</span><span class="o">,</span><span class="n">outMan</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">in</span><span class="o">(</span><span class="n">String</span> <span class="n">inMan</span><span class="o">,</span> <span class="kt">double</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">&#34;update account set money=money+? where name=?&#34;</span><span class="o">,</span><span class="n">money</span><span class="o">,</span><span class="n">inMan</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ol start="2">
<li>编写 AccoutService</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="o">(</span><span class="s">&#34;accountService&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Transactional</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountServiceImpl</span> <span class="kd">implements</span> <span class="n">AccountService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AccountDao</span> <span class="n">accountDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">isolation</span> <span class="o">=</span> <span class="n">Isolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">,</span><span class="n">propagation</span> <span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transfer</span><span class="o">(</span><span class="n">String</span> <span class="n">outMan</span><span class="o">,</span> <span class="n">String</span> <span class="n">inMan</span><span class="o">,</span> <span class="kt">double</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">accountDao</span><span class="o">.</span><span class="na">out</span><span class="o">(</span><span class="n">outMan</span><span class="o">,</span><span class="n">money</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">accountDao</span><span class="o">.</span><span class="na">in</span><span class="o">(</span><span class="n">inMan</span><span class="o">,</span><span class="n">money</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ol start="3">
<li>编写 applicationContext.xml 配置文件</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;!—之前省略datsSource、jdbcTemplate、平台事务管理器的配置--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--组件扫描--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.itheima&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--事务的注解驱动--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;tx:annotation-driven/&gt;</span>
</span></span></code></pre></div><h4 id="注解配置声明式事务控制解析">注解配置声明式事务控制解析</h4>
<ol>
<li>使用 @Transactional 在需要进行事务控制的类或是方法上修饰，注解可用的属性同 xml 配置方式，例如隔离级别、传播行为等。</li>
<li>注解使用在类上，那么该类下的所有方法都使用同一套注解参数配置。</li>
<li>使用在方法上，不同的方法可以采用不同的事务参数配置。</li>
<li>要使用使用 @Transactional ，Xml配置文件中要开启事务的注解驱动&lt;tx:annotation-driven /&gt;</li>
</ol>
<h2 id="spring集成web环境">Spring集成web环境</h2>
<h3 id="applicationcontext应用上下文获取方式">ApplicationContext应用上下文获取方式</h3>
<p>应用上下文对象是通过new ClasspathXmlApplicationContext(spring配置文件) 方式获取的，但是每次从容器中获得Bean时都要编写new ClasspathXmlApplicationContext(spring配置文件) ，这样的弊端是配置文件加载多次，应用上下文对象创建多次。</p>
<p>在Web项目中，可以使用ServletContextListener监听Web应用的启动，我们可以在Web应用启动时，就加载Spring的配置文件，创建应用上下文对象ApplicationContext，在将其存储到最大的域servletContext域中，这样就可以在任意位置从域中获得应用上下文ApplicationContext对象了。</p>
<h3 id="spring提供获取应用上下文的工具">Spring提供获取应用上下文的工具</h3>
<p>上面的分析不用手动实现，Spring提供了一个监听器ContextLoaderListener就是对上述功能的封装，该监听器内部加载Spring配置文件，创建应用上下文对象，并存储到ServletContext域中，提供了一个客户端工具WebApplicationContextUtils供使用者获得应用上下文对象。</p>
<p>所以我们需要做的只有两件事：</p>
<p>①在web.xml中配置ContextLoaderListener监听器（导入spring-web坐标）</p>
<p>②使用WebApplicationContextUtils获得应用上下文对象ApplicationContext</p>
<h3 id="导入spring集成web的坐标">导入Spring集成web的坐标</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>5.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="配置contextloaderlistener监听器">配置ContextLoaderListener监听器</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--全局参数--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context-param&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;param-value&gt;</span>classpath:applicationContext.xml<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/context-param&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--Spring的监听器--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;listener&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&lt;listener-class&gt;</span>
</span></span><span class="line"><span class="cl">       org.springframework.web.context.ContextLoaderListener
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;/listener-class&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&lt;/listener&gt;</span>
</span></span></code></pre></div><h3 id="通过工具获得应用上下文对象">通过工具获得应用上下文对象</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="n">WebApplicationContextUtils</span><span class="o">.</span><span class="na">getWebApplicationContext</span><span class="o">(</span><span class="n">servletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">);</span>
</span></span></code></pre></div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-01-20</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" data-title="SSM框架-Spring" data-hashtags="后端,JavaWeb,Spring"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" data-hashtag="后端"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" data-title="SSM框架-Spring"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" data-title="SSM框架-Spring"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://yangfanjack.top/posts/ssm%E6%A1%86%E6%9E%B6-spring/" data-title="SSM框架-Spring"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E5%90%8E%E7%AB%AF/">后端</a>,&nbsp;<a href="/tags/javaweb/">JavaWeb</a>,&nbsp;<a href="/tags/spring/">Spring</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/%E7%B2%BE%E7%AE%80%E7%89%88js-jquery/" class="prev" rel="prev" title="精简版JS:jQuery"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>精简版JS:jQuery</a>
            <a href="/posts/ssm%E6%A1%86%E6%9E%B6-springmvc/" class="next" rel="next" title="SSM框架-SpringMVC">SSM框架-SpringMVC<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.109.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Jack Yang</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
