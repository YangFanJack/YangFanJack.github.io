<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>docker进阶指南 - JACK&#039;s BLOG</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="JACK&#039;s BLOG"><meta name="msapplication-TileImage" content="/image/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="JACK&#039;s BLOG"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="继续学习docker，将docker用于生产实践当中"><meta property="og:type" content="blog"><meta property="og:title" content="docker进阶指南"><meta property="og:url" content="https://yangfanjack.github.io/2020/11/20/docker%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/"><meta property="og:site_name" content="JACK&#039;s BLOG"><meta property="og:description" content="继续学习docker，将docker用于生产实践当中"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://rn7xzghaf.hb-bkt.clouddn.com/img20210101162717.png"><meta property="article:published_time" content="2020-11-20T07:51:50.000Z"><meta property="article:modified_time" content="2022-12-22T02:37:28.940Z"><meta property="article:author" content="Jack1024"><meta property="article:tag" content="笔记"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Docker"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="http://rn7xzghaf.hb-bkt.clouddn.com/img20210101162717.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://yangfanjack.github.io/2020/11/20/docker%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/"},"headline":"JACK's BLOG","image":["http://rn7xzghaf.hb-bkt.clouddn.com/img20210101162717.png"],"datePublished":"2020-11-20T07:51:50.000Z","dateModified":"2022-12-22T02:37:28.940Z","author":{"@type":"Person","name":"Jack1024"},"description":"继续学习docker，将docker用于生产实践当中"}</script><link rel="canonical" href="https://yangfanjack.github.io/2020/11/20/docker%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/"><link rel="icon" href="/image/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="JACK's BLOG" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/image/logoko.png" alt="JACK&#039;s BLOG" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/plan">Plan</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="http://rn7xzghaf.hb-bkt.clouddn.com/img20210101162717.png" alt="docker进阶指南"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-11-20T07:51:50.000Z" title="2020-11-20 3:51:50 ├F10: PM┤">2020-11-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-12-22T02:37:28.940Z" title="2022-12-22 10:37:28 ├F10: AM┤">2022-12-22</time></span><span class="level-item"><a class="link-muted" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span><span class="level-item">18 minutes read (About 2654 words)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">docker进阶指南</h1><div class="content"><h2 id="docker可视化"><a href="#docker可视化" class="headerlink" title="docker可视化"></a>docker可视化</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Portainer:利用Portainer可以轻松构建，管理及维护Docker环境，它基于容器安装，高效部署</span></span><br><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span><br><span class="line"><span class="comment"># Rancher:Rancher是一个开源的企业级全栈化容器部署及管理平台。Rancher为容器提供一揽子基础架构服务：CNI兼容的网络服务、存储服务、主机管理、负载均衡、防护墙……Rancher让上述服务跨越公有云、私有云、虚拟机、物理机环境运行，真正实现一键式应用部署和管理。</span></span><br><span class="line">docker run ‐di ‐‐name=rancher ‐p 9090:8080 rancher/server</span><br></pre></td></tr></table></figure>
<h2 id="docker的分层机制"><a href="#docker的分层机制" class="headerlink" title="docker的分层机制"></a>docker的分层机制</h2><p>Docker镜像是<strong>分层</strong>构建的，Dockerfile 中每条指令都会新建一层。例如以下 Dockerfile:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu:18.04</span><br><span class="line">COPY . /app</span><br><span class="line">RUN make /app</span><br><span class="line">CMD python /app/app.py</span><br></pre></td></tr></table></figure>
<p>以上四条指令会创建四层，分别对应<strong>基础镜像、复制文件、编译文件以及入口文件</strong>，每层只记录本层所做的更改，而这些层都是<strong>只读层(镜像层)<strong>。当你启动一个容器，Docker 会在最顶部添加</strong>读写层</strong>，你在容器内做的所有更改，如写日志、修改、删除文件等，都保存到了读写层内，一般称该层为<strong>容器层</strong>，如下图所示：</p>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201120162027.jpeg"></p>
<p>事实上，<strong>容器（container）和镜像（image）的最主要区别就是容器加上了顶层的读写层</strong>。所有对容器的修改都发生在此层，镜像并不会被修改，也即前面说的 COW(copy-on-write)技术。容器需要读取某个文件时，直接从底部只读层去读即可，而如果需要修改某文件，则将该文件拷贝到顶部读写层进行修改，只读层保持不变。</p>
<p><strong>每个容器都有自己的读写层</strong>，因此多个容器可以使用同一个镜像，另外容器被删除时，其对应的读写层也会被删除（如果你<strong>希望多个容器共享或者持久化数据，可以使用 Docker volume</strong>）。</p>
<p>最后，执行命令 docker ps -s，可以看到最后有两列 size 和 virtual size。其中 size就是容器读写层占用的磁盘空间，而 virtual size 就是读写层加上对应只读层所占用的磁盘空间。如果两个容器是从同一个镜像创建，那么只读层就是 100%共享，即使不是从同一镜像创建，其镜像仍然可能共享部分只读层（如一个镜像是基于另一个创建）。因此，docker 实际占用的磁盘空间远远小于 virtual size 的总和。</p>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker commit <span class="comment">#提交容器成为一个新的副本</span></span><br><span class="line">docker commit -m=<span class="string">&quot;描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器id 自定义目标镜像名:[版本号]</span><br></pre></td></tr></table></figure>


<p><strong>接下来是docker的三个精髓：容器数据卷，DockerFile，Docker网络</strong></p>
<h2 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h2><p>用来实现”删服务不删数据”，数据可持久化，将<strong>容器内的目录</strong>映射<strong>同步</strong>到<strong>宿主机的目录</strong>中，类似于双向绑定</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 宿主机目录:容器内目录 <span class="comment">#注意目录都是绝对地址</span></span><br><span class="line">docker inspect 容器id <span class="comment">#查看容器的具体同步目录信息Mount</span></span><br><span class="line"><span class="comment">#数据卷命令</span></span><br><span class="line">docker volume create <span class="comment">#创建数据卷</span></span><br><span class="line">docker volume inspect <span class="comment">#显示数据卷详细信息</span></span><br><span class="line">docker volume ls <span class="comment">#显示所有数据卷</span></span><br><span class="line">docker volume rm <span class="comment">#移除数据卷</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#具名和匿名挂载（都不指定路径）</span></span><br><span class="line">docker run -d -P name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">docker run -d -P name nginx01 -v /etc/nginx ngix</span><br><span class="line"></span><br><span class="line">所有的docker容器内的卷没有指定具体路径的情况下，都在`/var/lib/docker/volumes`下</span><br><span class="line"></span><br><span class="line">-v /宿主机路径：容器内路径   <span class="comment">#指定路径挂载</span></span><br><span class="line">-v 数据卷名：容器内路径  <span class="comment">#具名挂载</span></span><br><span class="line">-v 容器内路径  <span class="comment">#指定目录挂载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里的ro和rw代表读写权限，ro表示只读，rw表示读和写，对挂载出来的内容就进行了限制，ro表示只能通过宿主机进行改变，容器内无法操作</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DockerFile:用来构建docker镜像的构建文件，相当于一个命令脚本。</span></span><br><span class="line"><span class="comment">#镜像是层次的，脚本里的命令也是层次的</span></span><br><span class="line"><span class="comment">#格式：指令(大写) 参数</span></span><br><span class="line"><span class="comment">#每个命令就是镜像的一层</span></span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>] <span class="comment">#匿名挂载</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;------end-------&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">docker build -f dockerfile01 -t jack/centos</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#两个/多个容器之间同步数据（数据卷容器）</span></span><br><span class="line"><span class="comment">#docker02挂载到docker01上，此时docker01就是数据卷容器</span></span><br><span class="line">docker run -d -it --name docker02 --volumes--from docker01 jack/centos</span><br></pre></td></tr></table></figure>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#构建步骤</span></span><br><span class="line">1. 编写dockerfile文件</span><br><span class="line">2. docker build <span class="comment">#构建成为一个镜像</span></span><br><span class="line">3. docker run <span class="comment">#运行镜像</span></span><br><span class="line">4. docker push <span class="comment">#发布镜像（dockerhub，阿里云镜像仓库）</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基础知识</span></span><br><span class="line">1. 每个保留关键字（指令）都大写</span><br><span class="line">2. 执行从上到下</span><br><span class="line">3. <span class="string">&quot;#&quot;</span>表示注释</span><br><span class="line">4. 每一个指令都会创建提交到一个新的镜像层</span><br></pre></td></tr></table></figure>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201120220311.png"></p>
<p><strong>dockerfile是面向开发的，交付环境就是交付一个dockerfile文件：DockFile-&gt;DockerImages-&gt;Docker容器</strong></p>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201120220723.png"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="comment">#基础镜像</span></span><br><span class="line">MAINTAINER <span class="comment">#镜像是谁写的</span></span><br><span class="line">RUN <span class="comment">#镜像构建时需要运行的命令</span></span><br><span class="line">ADD <span class="comment">#添加内容（tocmat，mysql等）</span></span><br><span class="line">WORKDIR <span class="comment">#镜像的工作目录</span></span><br><span class="line">VOLUME <span class="comment">#挂载目录</span></span><br><span class="line">EXPOSE <span class="comment">#暴露的端口</span></span><br><span class="line">CMD <span class="comment">#指定容器启动的时候要运行的命令，只有最后一个会生效</span></span><br><span class="line">ENTRYPOINT <span class="comment">#指定容器启动的时候要运行的命令，可以追加命令</span></span><br><span class="line">ONBUILD <span class="comment">#只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行ONBUILD后的指令</span></span><br><span class="line">COPY <span class="comment">#将文件拷贝到目录中</span></span><br><span class="line">ENV <span class="comment">#构建的时候设置环境变量（例：mysql用户名）</span></span><br></pre></td></tr></table></figure>
<p><strong>实战：自定义centos</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mydocker-centos</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER jack&lt;yangfanjack1024@qq.com&gt;</span><br><span class="line">ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;-----end-----&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="comment">#ADD </span></span><br><span class="line"><span class="comment">#VOLUME </span></span><br><span class="line"><span class="comment">#ENTRYPOINT </span></span><br><span class="line"><span class="comment">#ONBUILD </span></span><br><span class="line"><span class="comment">#COPY </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#得到自定义镜像mycentos:0.1</span></span><br><span class="line">docker build -f mydocker-centos -t mycentos:0.1 .</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编写包含tomcat的centos自定义镜像</span></span><br><span class="line">1. 准备镜像文件tomvat和jdk的压缩包</span><br><span class="line">2. 编写dockerfile文件，官方命名Dockerfile，build会自动寻找这个文件，就不需要-f指定了</span><br><span class="line"></span><br><span class="line"><span class="comment">#Dockerfile文件</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER jack&lt;yangfanjack1024@qq.com&gt;</span><br><span class="line">COPY readme.txt /usr/<span class="built_in">local</span>/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u271-linux-x64.tar.gz /usr/<span class="built_in">local</span></span><br><span class="line">ADD apache-tomcat-9.0.40.tar.gz /usr/<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line">WORK <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置环境变量</span></span><br><span class="line">ENV JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_271</span><br><span class="line">ENV CLASSPATH=<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/<span class="built_in">local</span>/apache-tomcat-9.0.40</span><br><span class="line">ENV CATALINA_BASE /usr/<span class="built_in">local</span>/apache-tomcat-9.0.40</span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/<span class="built_in">local</span>/apache-tomcat-9.0.40/bin/startup.sh &amp;&amp; tail -F /usr/<span class="built_in">local</span>/apache-tomcat-9.0.40/bin/logs/catalina.out</span><br><span class="line"></span><br><span class="line"><span class="comment">#构建自定义tomcat的镜像</span></span><br><span class="line">docker build -t diytomcat .</span><br><span class="line"><span class="comment">#启动tomcat</span></span><br><span class="line">docker run -d -p 8080:8080 --name jacktomcat -v /root/<span class="built_in">test</span>/:/usr/<span class="built_in">local</span>/apache-tomcat-9.0.40/webapps/<span class="built_in">test</span>/ -v /root/tomcatlogs/:/usr/<span class="built_in">local</span>/apache-tomcat-9.0.40/logs/ diytomcat</span><br><span class="line"></span><br><span class="line"><span class="comment">#然后直接在宿主机的test中发布网站即可</span></span><br></pre></td></tr></table></figure>
<p><strong>发布镜像到dockerhub和阿里云</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先注册</span></span><br><span class="line">https://hub.docker.com/</span><br><span class="line"><span class="comment">#在宿主机登录</span></span><br><span class="line">docker login -u XXX -p XXX</span><br><span class="line"><span class="comment">#发布前先用tag命令修改为规范的镜像</span></span><br><span class="line">docker tag 镜像id jack/diytomcat:1.0</span><br><span class="line">docker push jack/diytomcat:1.0</span><br><span class="line"><span class="comment">#提交的时候就是按照层级来发布的</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先注册</span></span><br><span class="line">https://www.aliyun.com/?spm=5176.12901015.ahjq0uaqt.1.a8fd525cv7uh0R</span><br><span class="line"><span class="comment">#找到容器镜像服务</span></span><br><span class="line"><span class="comment">#创建命名空间（一个账号只能创建三个）</span></span><br><span class="line"><span class="comment">#创建镜像仓库</span></span><br><span class="line"><span class="comment">#之后阿里云会有官方详细步骤</span></span><br><span class="line">docker login XXXXXXXXXXXXXXX</span><br><span class="line">docker tag XXXXXXXXXXXXX</span><br><span class="line">docker push jack/diytomcat:1.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>docker所有流程</strong></p>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121084949.png"></p>
<h2 id="Docker网络（容器编排，集群部署）"><a href="#Docker网络（容器编排，集群部署）" class="headerlink" title="Docker网络（容器编排，集群部署）"></a>Docker网络（容器编排，集群部署）</h2><p><strong>docker网络模式</strong>：有如下四种：</p>
<p> host模式(–net=host)      container模式         none模式(–net=none)          bridge模式(–net=bridge)</p>
<p><strong>host模式</strong>： 需要使用<strong>docker run</strong>是指定： <strong>–net=host</strong>   使用的网络实际上和宿主机是一样,在容器内的IP和宿主机的IP是一样,类似于<strong>vmare桥接模式</strong>；</p>
<p>container模式：使用 <strong>–net=container:container_id/container_name</strong>，多个容器使用共同的网络,看到的IP是一样的；</p>
<p>none模式： -<strong>-net=none</strong>  这种模式下,不会配置任何网络；</p>
<p><strong>bridge模式</strong>：**–net=bridge**，不指定是默认也是这种模式，这种模式会为每个容器分配一个独立的network 网卡，同一个宿主机是在同一个网段下可以通信的，类似于 <strong>VMware 的 NAT模式</strong>；</p>
<p><strong>桥接模式</strong>（类似于vm的nat模式）</p>
<img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121122657.png" style="zoom: 67%;" />

<img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121122811.png" style="zoom:50%;" />

<p><strong>host模式</strong>（类似于vm的桥接模式）</p>
<img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121122812.png" style="zoom:50%;" />



<p><strong>两个docker网络如何通信呢？</strong></p>
<ul>
<li>一台bai计算机是可以有多个IP地址的，如果我们给一台du服务器绑定两个以上zhiIP地址dao，其中一个IP地址在一个网段中(如192.168.1.0)，另一个IP地址在另一个网段中(如192.168.2.0)，如果给服务器提供路由功能，这两个IP地址充当网关，就可以把两个网段连接在一起了。</li>
</ul>
<p><strong>接下来是实战：Docker Compose，Docker Swarm，CI/CD Jenkins</strong></p>
<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121112356.png" style="zoom:50%;" />

<p><strong>DevOps（Development和Operations</strong>的组合词）是一组过程、方法与系统的统称，用于促进开发（应用程序/软件工程）、技术运营和质量保障（QA）部门之间的沟通、协作与整合。</p>
<p>它是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。</p>
<p>它的出现是由于软件行业日益清晰地认识到：为了按时交付软件产品和服务，开发和运维工作必须紧密合作。</p>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121111806.png"></p>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121112357.png"></p>
<p><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20201121112358.png"></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>docker进阶指南</p><p><a href="https://yangfanjack.github.io/2020/11/20/docker进阶指南/">https://yangfanjack.github.io/2020/11/20/docker进阶指南/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Jack1024</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-11-20</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-12-22</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="link-muted mr-2" rel="tag" href="/tags/Linux/">Linux</a><a class="link-muted mr-2" rel="tag" href="/tags/Docker/">Docker</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6043a11d32910c0018e217f7&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/11/21/Martin-Fowler%E5%85%B3%E4%BA%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E7%9A%84%E8%AE%BA%E6%96%87%E8%AF%91%E6%96%87/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Martin Fowler关于微服务架构的论文译文</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/11/20/linux%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/"><span class="level-item">linux网络配置</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.6.2/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "2ab8e7cbe67a394e2073d3ff3c89d425",
            repo: "gitalk-comment",
            owner: "yangfanjack",
            clientID: "c12e18c31ac7cd568589",
            clientSecret: "f381392cab6b4fd6c0526092be05029fbdc00215",
            admin: ["yangfanjack"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            proxy: "https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token",
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#docker可视化"><span class="level-left"><span class="level-item">1</span><span class="level-item">docker可视化</span></span></a></li><li><a class="level is-mobile" href="#docker的分层机制"><span class="level-left"><span class="level-item">2</span><span class="level-item">docker的分层机制</span></span></a></li><li><a class="level is-mobile" href="#commit镜像"><span class="level-left"><span class="level-item">3</span><span class="level-item">commit镜像</span></span></a></li><li><a class="level is-mobile" href="#容器数据卷"><span class="level-left"><span class="level-item">4</span><span class="level-item">容器数据卷</span></span></a></li><li><a class="level is-mobile" href="#DockerFile"><span class="level-left"><span class="level-item">5</span><span class="level-item">DockerFile</span></span></a></li><li><a class="level is-mobile" href="#Docker网络（容器编排，集群部署）"><span class="level-left"><span class="level-item">6</span><span class="level-item">Docker网络（容器编排，集群部署）</span></span></a></li><li><a class="level is-mobile" href="#DevOps"><span class="level-left"><span class="level-item">7</span><span class="level-item">DevOps</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/2022/03/30/win10%E5%A3%81%E7%BA%B8bingtoday/"><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20220521232604.png" alt="win10壁纸bingtoday"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-03-30T00:27:58.000Z">2022-03-30</time></p><p class="title"><a href="/2022/03/30/win10%E5%A3%81%E7%BA%B8bingtoday/">win10壁纸bingtoday</a></p><p class="categories"><a href="/categories/%E5%88%86%E4%BA%AB/">分享</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/12/01/RPM%E6%89%93%E5%8C%85%E5%88%9D%E8%AF%95/"><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img20210101160711.jpg" alt="RPM打包初试"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-12-01T02:44:01.000Z">2021-12-01</time></p><p class="title"><a href="/2021/12/01/RPM%E6%89%93%E5%8C%85%E5%88%9D%E8%AF%95/">RPM打包初试</a></p><p class="categories"><a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/10/13/%E5%9B%BD%E5%BA%86%E5%8C%97%E4%BA%AC%E7%8B%AC%E6%B8%B8/"><img src="http://rn7xzghaf.hb-bkt.clouddn.com/img221251.jpg" alt="国庆北京独游"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-10-13T00:13:19.000Z">2021-10-13</time></p><p class="title"><a href="/2021/10/13/%E5%9B%BD%E5%BA%86%E5%8C%97%E4%BA%AC%E7%8B%AC%E6%B8%B8/">国庆北京独游</a></p><p class="categories"><a href="/categories/%E5%88%86%E4%BA%AB/">分享</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/10/10/%E6%91%84%E5%BD%B1%E5%85%A5%E9%97%A8/"><img src="http://rn7xzghaf.hb-bkt.clouddn.com/imgff.jpg" alt="摄影入门"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-10-10T10:19:17.000Z">2021-10-10</time></p><p class="title"><a href="/2021/10/10/%E6%91%84%E5%BD%B1%E5%85%A5%E9%97%A8/">摄影入门</a></p><p class="categories"><a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/09/23/%E5%B7%A5%E4%BD%9C%E6%B5%81Activiti/"><img src="http://rn7xzghaf.hb-bkt.clouddn.com/imgimage-20210923201053126.png" alt="工作流Activiti"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-09-23T11:38:06.000Z">2021-09-23</time></p><p class="title"><a href="/2021/09/23/%E5%B7%A5%E4%BD%9C%E6%B5%81Activiti/">工作流Activiti</a></p><p class="categories"><a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/image/logoko.png" alt="JACK&#039;s BLOG" height="28"></a><p class="is-size-7"><span>&copy; 2022 Jack1024</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visited by <span id="busuanzi_value_site_uv">0</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>