<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>计网-网络层 - Jack&#39;s Blog Site</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Jack Yang" /><meta name="description" content="网络层提供的两种服务 争论的焦点是可靠交付应当有谁来负责？运输过程中只由运输层来决定，网络层不负责可靠传输，可靠传输应该由端系统决定。 网络层应" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.109.0 with theme even" />


<link rel="canonical" href="http://yangfanjack.top/post/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script src="https://cdn.jsdelivr.net/npm/eruda@1.2.6/eruda.min.js" integrity="sha256-Jmz4bc3kp+rRrXX2tGadNBKFLwtzMapr8kHABxSAAP8=" crossorigin="anonymous"></script>
<script>eruda.init();</script>

<link href="/sass/main.min.d7300728263f97567f4cac66927b734954ad136ded0a2da59723ddc926d7567b.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="计网-网络层" />
<meta property="og:description" content="网络层提供的两种服务 争论的焦点是可靠交付应当有谁来负责？运输过程中只由运输层来决定，网络层不负责可靠传输，可靠传输应该由端系统决定。 网络层应" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://yangfanjack.top/post/%E8%AE%A1%E7%BD%91-%E7%BD%91%E7%BB%9C%E5%B1%82/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-11-21T15:06:46+00:00" />
<meta property="article:modified_time" content="2020-11-21T15:06:46+00:00" />
<meta itemprop="name" content="计网-网络层">
<meta itemprop="description" content="网络层提供的两种服务 争论的焦点是可靠交付应当有谁来负责？运输过程中只由运输层来决定，网络层不负责可靠传输，可靠传输应该由端系统决定。 网络层应"><meta itemprop="datePublished" content="2020-11-21T15:06:46+00:00" />
<meta itemprop="dateModified" content="2020-11-21T15:06:46+00:00" />
<meta itemprop="wordCount" content="4657">
<meta itemprop="keywords" content="计算机网络," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="计网-网络层"/>
<meta name="twitter:description" content="网络层提供的两种服务 争论的焦点是可靠交付应当有谁来负责？运输过程中只由运输层来决定，网络层不负责可靠传输，可靠传输应该由端系统决定。 网络层应"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Jack&#39;s Blog Site</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a><a href="/search/">
        <li class="mobile-menu-item">Search</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Jack&#39;s Blog Site</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/search/">Search</a>
      </li>
  </ul>
</nav>

    </header>

    
      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">计网-网络层</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-11-21 </span>
        <div class="post-category">
            <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"> 学习笔记 </a>
            </div>
          <span class="more-meta"> 4657 words </span>
          <span class="more-meta"> 10 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#网络层提供的两种服务">网络层提供的两种服务</a></li>
        <li><a href="#网际协议ip">网际协议IP</a>
          <ul>
            <li><a href="#虚拟互连网">虚拟互连网</a></li>
            <li><a href="#ip地址">IP地址</a></li>
            <li><a href="#划分子网和构建超网">划分子网和构建超网</a></li>
            <li><a href="#ip地址和硬件mac地址">IP地址和硬件mac地址</a></li>
            <li><a href="#ip数据报格式">IP数据报格式</a></li>
            <li><a href="#ip转发分组的流程">IP转发分组的流程</a></li>
          </ul>
        </li>
        <li><a href="#网际控制报文协议icmp协议">网际控制报文协议ICMP协议</a></li>
        <li><a href="#路由协议">路由协议</a>
          <ul>
            <li><a href="#igp内部网关协议">IGP(内部网关协议)</a></li>
            <li><a href="#egp外部网关协议和igp外部网关协议">EGP(外部网关协议)和IGP(外部网关协议)</a></li>
          </ul>
        </li>
        <li><a href="#主机a135242523第一次和不同网段的主机b1352452123通信完整过程数据链路层和网络层">主机A（135.24.25.23）第一次和不同网段的主机B（135.24.52.123）通信完整过程（数据链路层和网络层）</a></li>
        <li><a href="#ip组播">IP组播</a></li>
        <li><a href="#虚拟专用网vpn">虚拟专用网VPN</a></li>
        <li><a href="#网络地址转换nat">网络地址转换NAT</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="网络层提供的两种服务">网络层提供的两种服务</h2>
<p>争论的焦点是<strong>可靠交付应当有谁来负责</strong>？运输过程中只由运输层来决定，网络层不负责可靠传输，可靠传输应该由端系统决定。</p>
<p>网络层应该向运输层提供怎样的服务？分组交换网提供两种传输服务:</p>
<ul>
<li><strong>虚电路服务</strong>：面向连接的，虚电路表示这只是一条逻辑上的连接，和电路交换的一真正的连接只是类似，但并不完全一样。是一种<strong>使所有分组顺序到达目的端</strong>的<strong>可靠性</strong>数据传输服务。</li>
<li><strong>数据报服务</strong>：无连接的，网络在发送分组时不需要先建立连接，每一个分组独立发送，与其前后的分组无关。是一种<strong>使分组按照独立路由到达目的端</strong>的数据传输服务，比虚电路更加灵活。</li>
<li>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201122213200.png" style="zoom:80%;margin-left:0px;" />
</li>
</ul>
<h2 id="网际协议ip">网际协议IP</h2>
<h3 id="虚拟互连网">虚拟互连网</h3>
<ul>
<li>
<p>网络互联的中间设备</p>
<ul>
<li>物理层中继系统：转发器，集线器</li>
<li>数据链路层终极系统：网桥，交换机</li>
<li>网络层中中继系统：路由器</li>
<li>网络层以上的中继系统：网关</li>
</ul>
</li>
<li>
<p>虚拟互连网也就是逻辑互联网络，就是互连起来的各种物理网络的异构性本来就是客观存在的，但是我们利用IP协议就可以使这些性能各异的网络从用户看起来就好像是一个统一的网络。</p>
</li>
<li>
<p><strong>网络层4个协议</strong></p>
<ul>
<li>IP协议：</li>
<li>ARP/RARP协议：</li>
<li>ICMP协议：</li>
<li>IGMP协议：</li>
</ul>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201122215345.png" style="zoom:50%;margin-left:0px;" />
</li>
</ul>
<h3 id="ip地址">IP地址</h3>
<ul>
<li>
<p>分层：分网络部分和主机部分</p>
</li>
<li>
<p>分类：A类（8+24），B类（16+16），C类（24+8），D类（组播），E类（研究）</p>
</li>
<li>
<p>二进制，十进制</p>
<ul>
<li>
<table>
<thead>
<tr>
<th>1</th>
<th>1</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>2</td>
</tr>
<tr>
<td>100</td>
<td>4</td>
</tr>
<tr>
<td>1000</td>
<td>8</td>
</tr>
<tr>
<td>10000</td>
<td>16</td>
</tr>
<tr>
<td>100000</td>
<td>32</td>
</tr>
<tr>
<td>1000000</td>
<td>64</td>
</tr>
<tr>
<td>10000000</td>
<td>128</td>
</tr>
<tr>
<td>11000000</td>
<td>192</td>
</tr>
<tr>
<td>11100000</td>
<td>224</td>
</tr>
<tr>
<td>11110000</td>
<td>240</td>
</tr>
<tr>
<td>11111000</td>
<td>248</td>
</tr>
<tr>
<td>11111100</td>
<td>252</td>
</tr>
<tr>
<td>11111110</td>
<td>254</td>
</tr>
<tr>
<td>11111111</td>
<td>255</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>A类 从1.0.0.0 到126.255.255.255
B类 从128.0.0.0到191.255.255.255
C类 从192.0.0.0到223.255.255.255</p>
</li>
<li>
<p>在IP地址3种主要类型里，各保留了3个区域作为<strong>私有地址</strong>，其地址范围如下：</p>
<p>A类地址：10.0.0.0～10.255.255.255</p>
<p>B类地址：172.16.0.0～172.31.255.255</p>
<p>C类地址：192.168.0.0～192.168.255.255</p>
<p><strong>注意：网段中主机部分不全为1，不全为0；全0代表这个网段，全1代表网段中的广播</strong></p>
</li>
<li>
<p>几个特殊ip地址：</p>
<ul>
<li>0.0.0.0：不是一个真正意义上的IP地址了。它表示的是这样一个集合：所有不清楚的主机和目的网络。</li>
</ul>
</li>
<li>
<p>255.255.255.255：限制广播地址</p>
<ul>
<li>
<p>244.0.0.1：组播地址</p>
</li>
<li>
<p>127.0.0.1：本地回环地址</p>
</li>
<li>
<p>169.254.0.0：一般开启了dhcp服务的设备但又无法获取到dhcp的会随机使用这个网段的ip</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="划分子网和构建超网">划分子网和构建超网</h3>
<ul>
<li>
<p>子网掩码是一个32位地址，用于屏蔽IP地址的一部分以区别网络标识和主机标识，并说明该IP地址是在<a href="https://baike.baidu.com/item/%E5%B1%80%E5%9F%9F%E7%BD%91/98626">局域网</a>上，还是在<a href="https://baike.baidu.com/item/%E5%B9%BF%E5%9F%9F%E7%BD%91/422004">广域网</a>上。用来判断自己和目标地址是否在一个网段、</p>
</li>
<li>
<p><strong>子网划分</strong>：解决IPV4不够用的情况</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124084545.png" style="zoom:67%;margin-left:0px;" />
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124083233.png" style="zoom:67%;margin-left:0px;" />
</li>
<li>
<p>C类地址分成四个子网：</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124083233.png" style="zoom:67%;margin-left:0px;" />
<p>点到点网络的子网掩码是X.X.X.252</p>
</li>
<li>
<p><strong>变长子网划分：</strong> 允许把子网继续划分为更小的网络</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124093444.png" style="zoom:67%;margin-left:0px;" />
</li>
<li>
<p>超网：</p>
<p>将多个子网合并为一个网</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124094613.png" style="zoom:80%;margin-left:0px;" />
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124094617.png" style="zoom:80%;margin-left:0px;" />
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124101306.png" style="zoom:67%;margin-left:0px;" />
</li>
</ul>
<h3 id="ip地址和硬件mac地址">IP地址和硬件mac地址</h3>
<ul>
<li>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124101437.png" style="zoom:50%;margin-left:0px;" />
</li>
<li>
<p>ip地址决定了数据包最终要到哪一个计算机，mac地址决定了下一跳给谁</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124102027.png" style="zoom:80%;margin-left:0px;" />
</li>
<li>
<p><strong>同一子网和同一网段可以看作一个意思</strong></p>
</li>
<li>
<p>代理服务器控制那些计算机能上网：同一网段可以用mac地址控制，但是不同网段只能通过ip地址控制。</p>
</li>
<li>
<p><strong>ARP协议：</strong></p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124153154.png" style="zoom: 67%;margin-left:0px;" />
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124130747.png" style="zoom: 50%;margin-left:0px;" />
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124153158.png" style="zoom:67%;margin-left:0px;" />
</li>
<li>
<p><strong>ARP欺骗：</strong></p>
<p>同一局域网里面的两台主机之间相互通信是通过Mac地址寻址的，而如果两台主机若不是处于同一子网里面，则在通信的时候会相互将数据发送给各自的路由器网关，通过网关的IP寻址以达到通信目的。但是网关和自己局域网里面的主机通信的时候还是依靠Mac地址寻址的，所以如果我们要把自己攻击机伪造成网关达到欺骗作用，就应该把目标主机上的网关Mac地址缓存改为攻击机的Mac地址（这就可以通过伪造ARP报文来实现）</p>
</li>
<li>
<p>逆向ARP：计算机请求ip地址的过程</p>
</li>
</ul>
<h3 id="ip数据报格式">IP数据报格式</h3>
<ul>
<li>
<p>由<strong>首部</strong>和<strong>数据</strong>两部分组成</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124160215.jpg" style="zoom:100%;margin-left:0px;" />
</li>
</ul>
<h3 id="ip转发分组的流程">IP转发分组的流程</h3>
<ul>
<li>数据路由：路由器在不同网段转发数据包</li>
<li>网络畅通的条件：能去能回
<ul>
<li>沿途路由器必须知道到目标网络下一跳给哪个接口</li>
<li>沿途路由器必须知道到源网络下一跳给哪个接口</li>
</ul>
</li>
</ul>
<h2 id="网际控制报文协议icmp协议">网际控制报文协议ICMP协议</h2>
<ul>
<li>
<p>为了提高IP数据包交付成功的机会，在网络层使用了网际控制报文协议ICMP</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124204747.png" style="zoom:80%;margin-left:0px;" />
</li>
<li>
<p>报告的错误：终点不可达；原点抑制；时间超过；参数问题；改变路由（重定向）</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124205206.png" style="zoom:80%;margin-left:0px;" />
</li>
<li>
<p>ping和pathping命令</p>
</li>
</ul>
<h2 id="路由协议">路由协议</h2>
<h3 id="igp内部网关协议">IGP(内部网关协议)</h3>
<h4 id="静态路由协议管理员手工配置路由信息">静态路由协议：管理员手工配置路由信息</h4>
<h4 id="动态路由协议rip距离向量路由算法是应用层协议">动态路由协议RIP：距离向量路由算法，是应用层协议</h4>
<ul>
<li>
<p>周期性广播(30s)，可以根据路由器状态变化动态的改变路由表</p>
</li>
<li>
<p>路由器只掌握物理相连的邻居及链路费用</p>
</li>
<li>
<p>动态地选择最佳路径</p>
</li>
<li>
<p>依据路由器跳数选择最佳路径</p>
</li>
<li>
<p>最大跳数16跳</p>
</li>
<li>
<p>网关就是默认路由</p>
</li>
<li>
<p>用命令来配置动态路由协议RIP：</p>
</li>
</ul>
<p>router rip</p>
<p>network （注意这里的ip地址要看该路由器所连接的几个网段具体属于ABC哪类网，来决定要配置几次）</p>
  <img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124212811.png" style="zoom: 50%;margin-left:0px;" />
<h4 id="动态路由协议ospf链路状态路由算法是传输层协议">动态路由协议OSPF：链路状态路由算法，是传输层协议</h4>
<ul>
<li>
<p>所有路由器掌握完整的网路拓扑和链路费用信息</p>
</li>
<li>
<p>依据带宽来选择最佳路径</p>
</li>
<li>
<p>支持多区域，触发式更新</p>
</li>
<li>
<p>三个表：邻居表，链路状态表，计算路由表</p>
</li>
<li>
<p>用命令来配置动态路由协议OSPF：</p>
<p>router rip</p>
<p>network （注意这里的ip地址要看该路由器所连接的几个网段具体属于ABC哪类网，来决定要配置几次）</p>
</li>
</ul>
<h3 id="egp外部网关协议和igp外部网关协议">EGP(外部网关协议)和IGP(外部网关协议)</h3>
<ul>
<li>IGP：一个自治系统AS内使用的路由选择协议
<ul>
<li>BGP协议 ：发言人机制</li>
</ul>
</li>
<li>EGP：在自治系统AS之间使用的路由选择协议
<ul>
<li>RIP协议</li>
<li>OSPF协议</li>
</ul>
</li>
</ul>
<h2 id="主机a135242523第一次和不同网段的主机b1352452123通信完整过程数据链路层和网络层">主机A（135.24.25.23）第一次和不同网段的主机B（135.24.52.123）通信完整过程（数据链路层和网络层）</h2>
<ul>
<li>A封装好要发送的数据，在要写目的地址时</li>
<li>A会用子网掩码将自己和目的的ip地址做与运算，判断A和B是否在一个网段，如果不在一个网段，A就知道该用网关把自己的数据传递给B，所以A会广播一个ARP包（连带A自己的ip和mac地址）来获取网关的mac地址</li>
<li>网关收到ARP包后，先把A的ip和mac地址记录下来，然后把自己的ip和mac地址封装在ARP包中，发送给A</li>
<li>A封装报文，源mac地址写A自己的mac地址，目标mac地址写网关mac地址，源ip地址写A自己的ip地址，目标ip地址写B的ip地址。</li>
<li>网关收到报文后，发现是给我自己发的，就开始解包，解开后，通过目标ip地址发现是给另一个网段的主机发送的</li>
<li>此时如果网关本身就是路由器就直接把数据报把送给吓一跳路由器，如果网关是普通的PC，那么就发送给路由器，由路由器发送给下一跳路由器，目标mac地址写下一跳路由器的mac地址。</li>
<li>（注意：在公网环境中，从源主机向目标主机请求发送数据时，源ip地址和目的ip地址在传输过程中是不需要改变的，但是由于大部分的情况是源主机是位于局域网环境中，所以，考虑NAT的因素，需要在从保留地址到公网ip的变化中同时也要改变源ip的地址。此时，对于目标ip地址，肯定是公网ip，因为不可能用局域网ip去访问另一个网段中的局域网ip）</li>
<li>历经千辛万苦，报文段终于到达了B的主机的路由器，路由器发送报文到B所在的网段的网关</li>
<li>C网段的网关解包后发现不是给自己的，而是给自己网段内的B主机（这里再次用arp协议来实现同一个网段内的通信，先用arp发送一个广播，得到主机B的ip和mac地址，然后就可以在数据链路层中完成同一个网段的通信），就发送给了C主机</li>
</ul>
<p><strong>另一个个差不多的过程说明，差不多：</strong></p>
<ul>
<li>
<p>广播只有2层的。跨网段访问是寻址。
给你举一个例子，详细说一下数据包的转发流程，环境是三层交换机有两个网段，10.0.0.1/24和192.168.0.1/24，pc1是10段的，pc2是192段的。pc1要与pc2通信。过程如下
1.pc1将要与pc2通信，首先根据网卡的ip地址与掩码算出pc2是否与pc1是同网段，如果是同网段直接二层转发，如果不是将跨网段转发
2.pc1算出pc2和自己不是同网段，所以要将数据包发送到网关由网关进行三层寻址转发。
3.pc1到网关为二层转发，也就是数据帧转发，数据帧转发需要知道对方mac地址，首先pc1会读电脑的arp缓存，看是否有网关ip与mac地址的对应关系，如果有将直接封装帧转发；如果没有将使用arp协议也就是广播，携带自己的ip地址与mac地址，目的地址为网关ip，mac地址为ffff-ffff-ffff。网关收到此arp广播后，将回复pc1自己的mac地址，数据包为源网关ip和mac地址目的为pc1ip和mac地址。
4.pc1收到数据包后会将此ip和mac地址写入到电脑的arp缓存表里，并直接封装数据包，三层ip头为源pc1-ip，目的为pc2-ip，二层帧格式为源pc1-mac，目的为网关mac地址（记住此包头）。
5.网关将收到pc1发来的数据包，进行拆包，根据其目的ip地址进行寻址（路由表），找到对应的路径（也就是192段vlan）。
6.三层交换机会根据其目的ip地址进行本机的arp缓存查找，如果查找到ip和mac地址的对应关系将直接封装转发，如果没有交换机将发送arp广播包获取目的ip地址的mac地址（广播包将只发送192段vlan，其他vlan不广播）。
7.三层交换机得知pc2-mac地址后将转发数据，三层包头为源pc1-ip，目的为pc2-i，二层帧包头为源192段网关mac，目的为pc2-mac。
8.pc2将收到三层交换发来的数据包，进行拆封即可获取数据，并回复pc1过程同上。</p>
<p>三层交换机等同于路由器。也就是说源ip和目的ip在数据包里一直不变（不经过nat的情况），mac地址将时刻改变。广播只存在二层。三层情况下是路由寻址。</p>
</li>
</ul>
<h2 id="ip组播">IP组播</h2>
<ul>
<li>IGMP协议：是TCP/IP 协议族中负责IP组播成员管理的协议，用来在IP主机和与其直接相邻的组播路由器之间建立、维护组播组成员关系。</li>
</ul>
<h2 id="虚拟专用网vpn">虚拟专用网VPN</h2>
<ul>
<li>VPN：Virtual Private Network，目的是建立更加安全私密的远程连接</li>
<li>形象解释就是在巨大的错综复杂的互联网环境中建立一条两个路由器之间的直通隧道</li>
<li>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201125090725.png" style="zoom:80%;margin-left:0px;" />
</li>
</ul>
<h2 id="网络地址转换nat">网络地址转换NAT</h2>
<ul>
<li>
<p>从局域网地址到公网地址的转化，可以大大缓解ipv4不够用的情况</p>
</li>
<li>
<p>NAT分为静态NAT，动态NAT和PAT，前两种NAT都是针对ip而言的对应，只不过一个是一对一，一个是多对多，现在所说的NAT实际上是PAT（Port Address Translation：端口地址转换）：</p>
<ul>
<li>NAT的地址转换是指每个内网地址都被转换成ip地址+源端口的方式，这需要公网ip地址为多个。</li>
<li>而PAT由于ip地址不足够，就会出现内网地址被转换成ip地址+端口段的形式，这样的公网ip地址通常只是一个。</li>
<li>举个例子：
<ul>
<li>NAT
　　192.168.0.2：4444 &mdash;-〉202.116.100.5：4444
　　192.168.0.3：5555 &mdash;-〉202.116.100.6：5555
　　192.168.0.10：1233 &mdash;〉202.116.100.5：1233</li>
<li>PAT
　　192.168.0.2：4444 &mdash;-〉202.116.100.5：50003
　　192.168.0.3：5555&mdash;-〉202.116.100.5：50004
　　192.168.0.10：1233 &mdash;〉202.116.100.5：50005</li>
<li><strong>简单来说，PAT是多对1，NAT是多对多.</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>NAT原理图</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124233628.png" style="zoom: 33%;margin-left:0px;" />
</li>
<li>
<p>端口映射：</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124233635.png" style="zoom:33%;margin-left:0px;" />
</li>
<li>
<p>内网穿透</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124233640.png" style="zoom:33%;margin-left:0px;" />
</li>
<li>
<p>可见，端口映射和内网穿透技术都可以实现非同网段访问局域网ip，但是因为国内的网络环境是如图所示的套娃情况。NAT的实现往往不是一层，而是多层，所以基本不可能用端口映射的方式实现本地局域网PC的外雇访问。有什么解决方法呢？一.让ISP给你的第一层路由器分配一个公网ip，很难，几乎不可能。二.花钱买内网穿透服务，很贵且限流。</p>
<img src="https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/img20201124233704.png" style="zoom:33%;margin-left:0px;" /></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Jack Yang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-11-21
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E8%AE%A1%E7%BD%91-%E8%BF%90%E8%BE%93%E5%B1%82/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">计网-运输层</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/%E8%AE%A1%E7%BD%91-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/">
            <span class="next-text nav-default">计网-数据链路层</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
          </div>
          

  

  

        </div>
      </main>
    

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:yangfanjack1024@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/yangfanjack" class="iconfont icon-github" title="github"></a>
      <a href="https://space.bilibili.com/383186587" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="http://yangfanjack.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>Jack Yang</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








<script>
  function createCopyButton(highlightDiv) {
    const div = document.createElement("div");
    div.className = "copy-code";
    div.innerText = "Copy";
    div.addEventListener("click", () =>
      copyCodeToClipboard(div, highlightDiv)
    );
    addCopyButtonToDom(div, highlightDiv);
  }

  async function copyCodeToClipboard(button, highlightDiv) {
    const codeToCopy = highlightDiv.querySelector(":last-child > .chroma > code")
      .innerText;
    await navigator.clipboard.writeText(codeToCopy);
    button.blur();
    button.innerText = "Copied!";
    setTimeout(() => button.innerText = "Copy", 2000);
  }

  function addCopyButtonToDom(button, highlightDiv) {
    highlightDiv.insertBefore(button, highlightDiv.firstChild);
    const wrapper = document.createElement("div");
    wrapper.className = "highlight-wrapper";
    highlightDiv.parentNode.insertBefore(wrapper, highlightDiv);
    wrapper.appendChild(highlightDiv);
  }

  document.querySelectorAll(".highlight")
    .forEach((highlightDiv) => createCopyButton(highlightDiv));
</script>  

</body>
</html>
