# MySQL运维


# 日志


# 主从复制
1. 概念：随着业务的增长，一台数据服务器已经满足不了需求了，负载过重。这个时候就需要减压了，实现负载均衡读写分离，一主一丛或一主多从。主服务器只负责写，而从服务器只负责读，从而提高了效率减轻压力。
2. 主从复制可以分为：
   1. 主从同步：用户写数据主服务器必须和从服务器同步了才告诉用户写入成功，等待时间比较长
   2. 主从异步：只要用户访问写数据主服务器，立即返回给用户
   3. 主从半同步：当用户访问写数据主服务器写入并同步其中一个从服务器就返回给用户成功
3. 形式：
   1. 一主一从&一主多从：一主一从和一主多从是我们现在见的最多的主从架构，使用起来简单有效，不仅可以实现 HA，而且还能读写分离，进而提升集群的并发能力
   2. 多主一从：可以将多个 MySQL 数据库备份到一台存储性能比较好的服务器上
   3. 双主复制：也就是可以互做主从复制，每个 master 既是 master，又是另外一台服务器的 salve。这样任何一方所做的变更，都会通过复制应用到另外一方的数据库中
   4. 级联复制：部分 slave 的数据同步不连接主节点，而是连接从节点。因为如果主节点有太多的从节点，就会损耗一部分性能用于 replication ，那么我们可以让 3~5 个从节点连接主节点，其它从节点作为二级或者三级与从节点连接，这样不仅可以缓解主节点的压力，并且对数据一致性没有负面影响。
4. 原理：
   1. MySQL 主从复制是基于主服务器在二进制日志跟踪所有对数据库的更改。因此，要进行复制，必须在主服务器上启用二进制日志
   2. 每个从服务器从主服务器接收已经记录到日志的数据。当一个从服务器连接到主服务器时，它通知主服务器从服务器日志中读取最后一个更新成功的位置
   3. 从服务器接收从那时发生起的任何更新，并在主机上执行相同的更新。然后封锁等待主服务器通知的更新
   4. 从服务器执行备份不会干扰主服务器，在备份过程中主服务器可以继续处理更新
5. 过程：
   1. ![过程](https://jack-blog-img.obs.cn-north-4.myhuaweicloud.com/github-page/5132b2c63a1331515f505679557dcf5971e8bc.png)
   2. 从库生成两个线程，一个 I/O 线程，一个 SQL 线程
   3. I/O 线程去请求主库的 binlog，并将得到的 binlog 日志写到 relay log(中继日志) 文件中
   4. 主库会生成一个 log dump 线程，用来给从库 I/O 线程传 binlog
   5. SQL 线程会读取 relay log 文件中的日志，并解析成具体操作，来实现主从的操作一致，而最终数据一致
6. 问题：
   1. 延迟
   2. 数据丢失：
   3. 
7. 作用：
   1. 数据更安全：做了数据冗余，不会因为单台服务器的宕机而丢失数据；可以进行数据库层面的读写分离；可以在从数据库上进行日常备份
   2. 性能大大提升：一主多从，不同用户从不同数据库读取，性能提升
   3. 扩展性更优：流量增大时，可以方便的增加从服务器，不影响系统使用
   4. 负载均衡：一主多从相当于分担了主机任务，做了负载均衡
# 分库分表


# 读写分离
